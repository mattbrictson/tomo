<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>git - Tomo</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "git";
        var mkdocs_page_input_path = "plugins/git.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script>
<script defer data-domain="tomo.mattbrictson.com" src="https://plausible.io/js/script.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Tomo
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../comparisons/">Comparisons</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../configuration/">Configuration</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Commands</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../commands/init/">init</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../commands/setup/">setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../commands/deploy/">deploy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../commands/run/">run</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../commands/tasks/">tasks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Plugins</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../core/">core</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bundler/">bundler</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../env/">env</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">git</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#settings">Settings</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#tasks">Tasks</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#gitconfig">git:config</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#gitclone">git:clone</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#gitcreate_release">git:create_release</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#helpers">Helpers</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#remotegitargs-options-tomoresult">remote.git(*args, **options) → Tomo::Result</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nodenv/">nodenv</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../puma/">puma</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../rails/">rails</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../rbenv/">rbenv</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/deploying-rails-from-scratch/">Deploying Rails From Scratch</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/writing-custom-tasks/">Writing Custom Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/publishing-a-plugin/">Publishing a Plugin</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/Host/">Tomo::Host</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/Logger/">Tomo::Logger</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/Paths/">Tomo::Paths</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/PluginDSL/">Tomo::PluginDSL</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/Remote/">Tomo::Remote</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/Result/">Tomo::Result</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/TaskLibrary/">Tomo::TaskLibrary</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/testing/MockPluginTester/">Tomo::Testing::MockPluginTester</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Tomo</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Plugins &raquo;</li>
        
      
    
    <li>git</li>
    <li class="wy-breadcrumbs-aside">
      
          <a href="https://github.com/mattbrictson/tomo/edit/main/docs/plugins/git.md" class="icon icon-github"
          > Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="git">git</h1>
<p>The git plugin uses git running on the remote host to fetch the code of the app being deployed. This &ldquo;remote pull&rdquo; technique is currently the only deployment method officially supported by tomo. For this to work, the SSH key you use to connect to the remote host via tomo must match the key expected by the git host (e.g. by GitHub).</p>
<h2 id="settings">Settings</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Purpose</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>git_branch</code></td>
<td>The branch of the repository to deploy</td>
<td><code>nil</code></td>
</tr>
<tr>
<td><code>git_repo_path</code></td>
<td>Directory on the remote host where a cache of the repository will be stored</td>
<td><code>"%{deploy_to}/git_repo"</code></td>
</tr>
<tr>
<td><code>git_exclusions</code></td>
<td>An array of paths (similar to gitignore syntax) that will be excluded when the repository is copied into a release; it is recommend you exclude <code>.tomo/</code> and other directories not needed in production, like <code>spec/</code></td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>git_env</code></td>
<td>Environment variables that will be set when issuing git commands (hash)</td>
<td><code>{ GIT_SSH_COMMAND: "ssh -o PasswordAuthentication=no -o StrictHostKeyChecking=no" }</code></td>
</tr>
<tr>
<td><code>git_ref</code></td>
<td>The commit SHA or tag to deploy (overrides <code>:git_branch</code>)</td>
<td><code>nil</code></td>
</tr>
<tr>
<td><code>git_url</code></td>
<td>URL of the git repository; always use the SSH form like <code>git@github.com:username/repo.git</code> (not HTTPS)</td>
<td><code>nil</code></td>
</tr>
<tr>
<td><code>git_user_name</code></td>
<td>The value to use for git&rsquo;s <code>user.name</code> config</td>
<td><code>nil</code></td>
</tr>
<tr>
<td><code>git_user_email</code></td>
<td>The value to use for git&rsquo;s <code>user.email</code> config</td>
<td><code>nil</code></td>
</tr>
</tbody>
</table>
<h2 id="tasks">Tasks</h2>
<h3 id="gitconfig">git:config</h3>
<p>Globally (for the deployer user) configures git with values for <code>user.name</code> and <code>user.email</code> so that certain git commands are able to function. By default, tomo will use the deployer username and append <code>@example.com</code> to generate these values, like this:</p>
<pre><code>git config --global user.name deployer
git config --global user.email deployer@example.com
</code></pre>
<p>If you wish to customize the name and email values, use the <code>git_user_name</code> and <code>git_user_email</code> settings.</p>
<p><code>git:config</code> is intended for use as a <a href="../../commands/setup/">setup</a> task.</p>
<h3 id="gitclone">git:clone</h3>
<p>Performs the initial clone of the git repository. This is necessary before a deploy can be performed. The clone of the repository will be stored in the <code>git_repo_path</code>. The <code>git_url</code> setting must be specified for this task to work.</p>
<p><code>git:clone</code> is intended for use as a <a href="../../commands/setup/">setup</a> task.</p>
<h3 id="gitcreate_release">git:create_release</h3>
<p>Fetches the latest commits from <code>git_branch</code> (or <code>git_ref</code>) and creates a release by copying the contents of that branch of repository into a new release inside the <code>releases_path</code>. Releases are numbered based on the timestamp of when the deploy takes place.</p>
<p><code>git:create_release</code> is intended for use as a <a href="../../commands/deploy/">deploy</a> task.</p>
<h2 id="helpers">Helpers</h2>
<p>These helper methods become available on instances of <a href="../../api/Remote/">Remote</a> when the git plugin is loaded. They accept the same <code>options</code> as <a href="../../api/Remote/#run42command-4242options-tomoresult">Remote#run</a>.</p>
<h3 id="remotegitargs-options-tomoresult">remote.git(*args, **options) → <a href="../../api/Result/">Tomo::Result</a></h3>
<p>Runs <code>git</code> with the environment variables specified by the <code>git_env</code> setting.</p>
<pre><code class="language-ruby">remote.git(&quot;fetch&quot;)
# $ export GIT_SSH_COMMAND=ssh\ -o\ PasswordAuthentication=no\ -o\ StrictHostKeyChecking=no &amp;&amp; git fetch
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../env/" class="btn btn-neutral float-left" title="env"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../nodenv/" class="btn btn-neutral float-right" title="nodenv">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/mattbrictson/tomo/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../env/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../nodenv/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../js/extra.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
